---
import type { StoreCollection } from "../../../lib/medusajs/products";
import CollectionSectionClient from "./CollectionSectionClient.tsx";

interface Props {
    collection: StoreCollection;
    productsPerSection?: number;
}

const DEFAULT_FOCUS_TEXT = "Colección";

const getFocusText = (collection: StoreCollection) => collection.title ?? collection.handle ?? DEFAULT_FOCUS_TEXT;

const getMetadataTitle = (collection: StoreCollection) => (typeof collection.metadata?.text === "string" ? (collection.metadata.text as string) : null);

const buildCollectionId = (collection: StoreCollection) => collection.id ?? collection.handle ?? "";

const buildHref = (collection: StoreCollection) => `/catalog?collection_id=${buildCollectionId(collection)}`;

const normalizeLimit = (value: number | undefined, fallback: number) => (Number.isFinite(value) && (value as number) > 0 ? Math.floor(value as number) : fallback);

const { collection, productsPerSection = 8 }: Props = Astro.props;

const limit = normalizeLimit(productsPerSection, 8);
const focusText = getFocusText(collection);
const metadataTitle = getMetadataTitle(collection);
const sectionTitle = metadataTitle ?? "Colección destacada";
const collectionId = buildCollectionId(collection);
const sectionId = collectionId ? `collection-section-${collectionId}` : undefined;
---

<section id={sectionId} class="card-section w-full rounded-2xl bg-linear-to-b from-[#f9fafb] via-white to-white py-8 shadow-sm sm:rounded-none sm:bg-transparent sm:py-12 sm:shadow-none">
    <div class="card-section__inner site-container space-y-8">
        <div class="card-section__header flex flex-wrap items-center justify-between gap-4">
            <h2 class="card-section__title text-2xl font-bold text-text-primary">
                {sectionTitle}
                <span class="block text-[#249b3e] sm:inline">{focusText}</span>
            </h2>
            <a href={buildHref(collection)} class="relative inline-flex items-center justify-start py-3 pl-4 pr-12 overflow-hidden font-semibold text-primary transition-all duration-150 ease-in-out rounded hover:pl-10 hover:pr-6 bg-gray-50 group">
                <span class="absolute bottom-0 left-0 w-full h-1 transition-all duration-150 ease-in-out bg-primary group-hover:h-full"></span>
                <span class="absolute right-0 pr-4 duration-200 ease-out group-hover:translate-x-12">
                    <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                    </svg>
                </span>
                <span class="absolute left-0 pl-2.5 -translate-x-12 group-hover:translate-x-0 ease-out duration-200">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                    </svg>
                </span>
                <span class="relative w-full text-left transition-colors duration-200 ease-in-out group-hover:text-white">Ver más</span>
            </a>
        </div>

        <div class="card-section__container relative w-full">
            <CollectionSectionClient client:load collectionId={collectionId} limit={limit} />
        </div>
    </div>
</section>

<style>
    .card-section__slider {
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .card-section__slider::-webkit-scrollbar {
        display: none;
    }
</style>

<style is:global>
    .slider-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #d1d5db;
        border: none;
        padding: 0;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .slider-dot.active {
        background-color: #299037;
        width: 24px;
        border-radius: 4px;
    }

    .slider-dot:hover {
        background-color: #9ca3af;
    }

    .slider-dot.active:hover {
        background-color: #207028;
    }
</style>
