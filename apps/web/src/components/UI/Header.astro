---
import Logo_mariquita from "../../assets/header/logo.svg";
import Carrito from "../../assets/header/carrito.svg";
import Location from "../../assets/header/icon_location.svg";
import Oferta from "../../assets/header/oferta.svg";
import type { StoreCollection } from "../../lib/medusajs/products";

interface Props {
  collections?: StoreCollection[];
}

const rawUrl = Astro.request.url;
const isHome = new URL(rawUrl).pathname === "/";
const { collections = [] }: Props = Astro.props;

const servicesCollections = collections.filter((collection) =>
  Boolean(collection?.id)
);
const navLinks = [
  { label: "Inicio", href: "/" },
  { label: "Nosotros", href: "/#nosotros" },
  { label: "Contacto", href: "/#contacto" },
];
---

<header class="w-full border-b border-gray-300">
  <!-- Header Top -->

  <div class="w-full bg-gray-100 text-gray-600 text-xs sm:text-sm">
    <div
      class="site-container flex flex-col md:flex-row items-center justify-between gap-2 py-1"
    >
      <p class="text-[12px] sm:text-xs md:text-sm">Snack sano, sabor intenso</p>

      <div class="flex flex-row items-center gap-2 sm:gap-4">
        <div
          class="flex items-center gap-1 sm:gap-2 cursor-pointer transition-transform duration-300 hover:scale-110"
        >
          <Location width={16} height={16} />
          <a class="text-[12px] sm:text-xs">Delivery: 0986345616</a>
        </div>

        <div class="hidden sm:block border-l border-gray-600 h-4"></div>

        <div
          class="flex items-center gap-1 sm:gap-2 cursor-pointer transition-transform duration-300 hover:scale-110"
        >
          <Oferta width={16} height={16} />
          <a class="text-[12px] sm:text-xs">Todas las ofertas</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Header Bottom -->
  <div class="w-full bg-white">
    <div
      class="site-container flex flex-col md:flex-row items-center justify-between py-2 gap-2 md:gap-4"
    >
      <!-- Logo -->
      <a href="/" class="flex-none flex items-center h-12 sm:h-14">
        <Logo_mariquita class="block h-full w-auto" />
      </a>

      <!-- Search + Carrito -->
      <div
        class="flex-1 flex flex-row items-center sm:justify-end gap-2 md:gap-4 w-full"
      >
        <input
          placeholder="Busca, elige y disfruta"
          class="w-full sm:max-w-[507px] h-10 sm:h-12 rounded-xl border border-gray-500 bg-white text-gray-600 px-3 sm:px-4 text-sm sm:text-base box-border"
        />
        <a href="/shoppingCar">
          <Carrito
            class="w-10 h-10 cursor-pointer transition-transform duration-300 hover:scale-110"
          />
        </a>
      </div>
    </div>
  </div>

  <nav class="w-full border-t border-gray-200 bg-white">
    <div
      class="site-container flex flex-col md:flex-row items-stretch md:items-center justify-between py-3 gap-3"
    >
      <ul
        class="flex flex-wrap items-center gap-3 md:gap-6 text-sm font-semibold text-[#1f2937]"
      >
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class="inline-flex items-center gap-1 px-3 py-2 rounded-full transition-colors duration-200 hover:bg-[#ecfbfd] hover:text-[#0f766e]"
              >
                {link.label}
              </a>
            </li>
          ))
        }

        <li class="relative">
          <details class="group peer" role="list">
            <summary
              class="list-none inline-flex items-center gap-2 px-3 py-2 rounded-full text-sm font-semibold text-[#1f2937] cursor-pointer transition-colors duration-200 hover:bg-[#ecfbfd] hover:text-[#0f766e]"
            >
              Productos y Servicios

              <span class="text-xs text-[#6b7280]">
                {servicesCollections.length}
              </span>
              <span
                class="transition-transform duration-300 group-open:rotate-180"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M7.29289 9.29289C7.68342 8.90237 8.31658 8.90237 8.70711 9.29289L12 12.5858L15.2929 9.29289C15.6834 8.90237 16.3166 8.90237 16.7071 9.29289C17.0976 9.68342 17.0976 10.3166 16.7071 10.7071L12.7071 14.7071C12.5196 14.8946 12.2652 15 12 15C11.7348 15 11.4804 14.8946 11.2929 14.7071L7.29289 10.7071C6.90237 10.3166 6.90237 9.68342 7.29289 9.29289Z"
                    fill="#000"></path>
                </svg>
              </span>
            </summary>

            <div
              class="absolute left-0 mt-2 min-w-[250px] rounded-xl border border-gray-200 bg-white shadow-xl p-3 z-40 origin-top scale-95 opacity-0 transform transition-all duration-200 ease-in-out group-open:opacity-100 group-open:scale-100"
            >
              <p class="text-xs uppercase tracking-wide text-[#9ca3af] mb-2">
                Productos y Servicios
              </p>
              <a
                href="/catalog"
                class="block w-full text-sm font-medium text-[#065f46] bg-[#ecfbfd] rounded-lg px-3 py-2 mb-2 hover:bg-[#d1f5f8]"
              >
                Ver todo el catálogo
              </a>
              {
                servicesCollections.length === 0 ? (
                  <p class="text-xs text-[#9ca3af]">
                    No hay colecciones disponibles.
                  </p>
                ) : (
                  <ul class="flex flex-col gap-1">
                    {servicesCollections.map((collection) => (
                      <li>
                        <a
                          href={`/catalog?collection_id=${collection.id ?? collection.handle}`}
                          class="flex flex-col rounded-md px-3 py-2 hover:bg-[#f3f4f6]"
                        >
                          {typeof collection.metadata?.text === "string" && (
                            <span class="text-xs text-[#6b72808f]">
                              {collection.metadata.text as string}
                            </span>
                          )}
                          <span class="text-sm font-medium text-[#1f2937]">
                            {collection.title ??
                              collection.handle ??
                              "Colección"}
                          </span>
                        </a>
                      </li>
                    ))}
                  </ul>
                )
              }
            </div>
          </details>
        </li>
      </ul>
    </div>
  </nav>
</header>
