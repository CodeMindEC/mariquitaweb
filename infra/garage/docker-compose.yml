version: "3.8"

services:
  garage:
    image: dxflrs/garage:v2.1.0
    container_name: garage
    restart: unless-stopped
    volumes:
      - garage_meta:/var/lib/garage/meta
      - garage_data:/var/lib/garage/data
      - ./garage.toml:/etc/garage.toml:ro
    # OJO con esto:
    # - 3900 lo abrimos para que Medusa/Strapi/Imagor puedan usarlo como S3.
    #   Si NO quieres que sea pÃºblico en internet, no abras este puerto en el firewall de Oracle.
    ports:
      - "3900:3900"

  garage-webui:
    image: khairul169/garage-webui:latest
    container_name: garage-webui
    restart: unless-stopped
    depends_on:
      - garage
    volumes:
      - ./garage.toml:/etc/garage.toml:ro
    environment:
      # Se conecta al API admin y al S3 DENTRO de la red docker
      API_BASE_URL: "http://garage:3903"
      S3_ENDPOINT_URL: "http://garage:3900"
    # Solo accesible por localhost -> luego lo ves con SSH tunnel
    ports:
      - "127.0.0.1:3909:3909"

volumes:
  garage_meta:
  garage_data:
